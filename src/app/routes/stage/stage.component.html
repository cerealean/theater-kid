<div class="h-[calc(100vh-56px)] flex flex-col">
  <!-- Messages area with fixed height and scroll -->
  <div class="flex-1 overflow-y-auto min-h-0">
    <div class="container max-w-screen-md mx-auto p-4 space-y-3">
      @for (m of messages(); track m.content) {
        <div class="flex">
          <div
            class="max-w-[80ch] w-fit px-4 py-3 rounded-2xl shadow-md border border-white/10"
            [ngClass]="{
              'ml-auto': m.role === 'user',
              'bg-white/5': m.role !== 'assistant',
              'bg-purple-500/10': m.role === 'assistant',
            }"
          >
            @if (m.role === 'system') {
              <div class="text-xs opacity-70 mb-1">System</div>
            }
            <div class="prose prose-invert max-w-none" [innerHTML]="md.render(m.content)"></div>
          </div>
        </div>
      }
      @if (messages().length === 0) {
        <div class="flex items-center justify-center h-full text-white/60">
          <div class="text-center">
            <div class="text-4xl mb-4">ðŸŽ­</div>
            <div class="text-lg">Welcome to the Stage</div>
            <div class="text-sm">Start a conversation to begin your scene</div>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Input area pinned to bottom -->
  <div class="flex-shrink-0 border-t border-white/20 bg-black/40 backdrop-blur-sm shadow-lg">
    <div class="max-w-screen-md mx-auto p-4">
      <textarea
        class="tk-input w-full p-3 resize-none"
        rows="4"
        placeholder="Type and hit Sendâ€¦ (Shift+Enter newline)"
        [(ngModel)]="inputValue"
        (keydown.enter)="onEnterKey($any($event))"
      ></textarea>
      <div class="mt-3 flex items-center justify-end gap-2">
        <input
          class="tk-input px-3 py-2 w-full"
          placeholder="(optional) System prompt for this scene"
          [(ngModel)]="systemValue"
        />
        <button class="tk-btn px-4 py-2 font-medium" (click)="send()" [disabled]="busy()">
          {{ busy() ? 'Sending...' : 'Send' }}
        </button>
      </div>
    </div>
  </div>
</div>
