<div class="h-[calc(100vh-56px)] flex flex-col lg:flex-row">
  <!-- Main chat area -->
  <div class="flex-1 flex flex-col">
    <main class="tk-stage tk-proscenium relative overflow-auto" tkSpotlight>
      <div class="tk-spotlight" aria-hidden="true"></div>

      <div class="tk-valance" aria-hidden="true"></div>
      <div class="tk-wing tk-wing-left" aria-hidden="true"></div>
      <div class="tk-wing tk-wing-right" aria-hidden="true"></div>
      <div class="tk-floor" aria-hidden="true"></div>
      <div class="tk-footlights" aria-hidden="true"></div>
      <!-- remove the next line if you don't want the audience silhouettes -->
      <div class="tk-audience" aria-hidden="true"></div>

      <div class="tk-content relative z-[2]">
        <!-- Messages area with fixed height and scroll -->
        <div class="flex-1 overflow-y-auto min-h-0">
          <div class="container max-w-screen-md mx-auto p-4 space-y-3">
            @for (m of messages(); track m.content) {
              <div class="flex">
                <div
                  class="max-w-[80ch] w-fit px-4 py-3 rounded-2xl shadow-md border border-white/10"
                  [ngClass]="{
                    'ml-auto': m.role === 'user',
                    'bg-white/5': m.role !== 'assistant',
                    'bg-purple-500/10': m.role === 'assistant',
                  }"
                >
                  @if (m.role === 'system') {
                    <div class="text-xs opacity-70 mb-1">System</div>
                  }
                  <div
                    class="prose prose-invert max-w-none"
                    [innerHTML]="md.render(m.content)"
                  ></div>
                </div>
              </div>
            }
            @if (messages().length === 0) {
              <div class="flex items-center justify-center h-full text-white/60">
                <div class="text-center">
                  <div class="text-4xl mb-4">ðŸŽ­</div>
                  <div class="text-lg">Welcome to the Stage</div>
                  <div class="text-sm">Start a conversation to begin your scene</div>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Input area component -->
        <tk-stage-input
          [(inputValue)]="inputValue"
          [(systemValue)]="systemValue"
          [busy]="busy()"
          (send)="send()"
          (enterKey)="onEnterKey($any($event))"
        ></tk-stage-input>
      </div>
    </main>
  </div>

  <!-- Theater Booth component -->
  <tk-theater-booth
    [currentCharacter]="currentCharacter()"
    [characterRole]="characterRole()"
    [sceneContext]="sceneContext()"
    [characterTraits]="characterTraits()"
    [performanceNotes]="performanceNotes()"
    (toggleSpotlight)="toggleSpotlight()"
    (toggleCurtains)="toggleCurtains()"
    (toggleMusic)="toggleMusic()"
    (triggerApplause)="triggerApplause()"
    (resetCharacter)="resetCharacter()"
  ></tk-theater-booth>
</div>
